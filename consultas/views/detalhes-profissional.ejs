<!DOCTYPE html>
<html lang="pt-br">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles/detalhes-profissional.css">
    <title>Detalhes do Profissional</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
      }
    
      /* Header */
      header {
        background-color: #007bff;
        /* Fundo azul */
        color: white;
        /* Texto branco */
        position: relative;
        /* Para posicionar o botão */
        text-align: center;
        /* Centraliza o título */
        padding: 0.75rem 1rem;
      }
    
      header h1 {
        font-size: 1.5rem;
        color: white;
        /* Garante que o texto fique branco */
        margin: 0;
        /* Remove margens do título */
      }
    
      header .btn {
        position: absolute;
        /* Posiciona o botão */
        left: 15px;
        /* Distância da borda esquerda */
        top: 50%;
        /* Centraliza verticalmente */
        transform: translateY(-50%);
        border: none;
        /* Remove borda do botão */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        /* Sombra sutil */
        transition: transform 0.2s ease, background-color 0.2s ease;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        /* Botão arredondado */
        background-color: #fff;
        /* Fundo branco */
        color: #007bff;
        /* Texto azul */
        display: flex;
        align-items: center;
        justify-content: center;
      }
    
      header .btn:hover {
        transform: scale(1.1);
        /* Aumenta o tamanho ao passar o mouse */
        
      }
    
      /* Containers */
      .content {
        padding: 20px 0;
      }
    
      .container {
        display: flex;
        gap: 20px;
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
      }
    
      /* Cards */
      .card {
        flex: 1;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        padding: 20px;
      }
    
      .card.profissional {
        background-color: #e9ecef;
        width: 100px;
        /* Define largura fixa */
        padding: 15px;
        /* Reduz espaçamento interno */
        margin: 10px auto;
        /* Centraliza o card */
      }
    
      .card.horarios {
        background-color: #f8f9fa;
        width: 50px;
        /* Define largura fixa */
        padding: 15px;
        /* Reduz espaçamento interno */
        margin: 10px auto;
        /* Centraliza o card */
      }
    
      .card h2 {
        margin-bottom: 20px;
        font-size: 1.2rem;
        color: #343a40;
      }
    
      /* Imagem do Profissional */
      .profissional-info img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        margin-bottom: 10px;
        object-fit: cover;
      }
    
      /* Lista de Horários */
      .horarios ul {
        list-style: none;
        padding: 0;
      }
    
      .horarios li {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }
    
      .horario-btn {
        width: 40px;
        height: 40px;
        border: 2px solid #3b5e83;
        border-radius: 50%;
        background: white;
        cursor: pointer;
        margin-right: 10px;
        transition: background 0.3s, border 0.3s;
      }
    
      .horario-btn.active {
        background: #007bff;
        color: #fff;
        border-color: #007bff;
      }
    
      .horario-btn:disabled {
        background: #ddd;
        cursor: not-allowed;
      }
    
      /* Planos */
      .planos-section {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
    
      .planos {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
    
      .plano {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border: 1px solid #4f1fb0;
        border-radius: 5px;
      }
    
      .plano button {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
      }
    
      .plano button:hover {
        background: #0056b3;
      }
    
      /* Responsividade */
      @media (max-width: 768px) {
        header h1 {
          font-size: 1.2rem;
          /* Reduz tamanho do título em telas menores */
        }
      }
    </style>


  </head>

  <body>
   
    <header class="p-3 bg-primary text-white">
      <div class="container d-flex align-items-center justify-content-between position-relative">
        <button onclick="history.back()"
          class="btn btn-light rounded-circle d-flex align-items-center justify-content-center"
          style="width: 40px; height: 40px; position: absolute; left: 0;">
          <i class="fas fa-arrow-left"></i>
        </button>
        <h1 class="fs-4 m-0 text-center w-100">Nossos Profissionais</h1>
      </div>
    </header>
    <div class="container">
      <!-- Card Profissional -->
      <div class="card profissional">
        <h2>Sobre o Profissional</h2>
        <div class="profissional-info">
          <% if (profissional.foto) { %>
            <img src="data:image/jpeg;base64,<%= profissional.foto.toString('base64') %>"
              alt="Foto de <%= profissional.nome %>">
            <% } else { %>
              <img src="/images/default-profile.png" alt="Foto padrão">
              <% } %>
                <h3>
                  <%= profissional.nome %>
                </h3>
                <p>
                  <%= profissional.descricao %>
                </p>
        </div>
      </div>

      <!-- Card Horários -->
      <div class="card horarios">
        <h2>Horários Disponíveis</h2>
        <ul>
          <% horariosDisponiveis.forEach(horario=> { %>
            <li>
              <button class="horario-btn" onclick="selecionarHorario(this, '<%= horario.data_horario_formatado %>')" <%
                if (!horario.disponivel) { %> disabled <% } %>>
                  &#x25CF;
              </button>
              <span class="horario-text">
                <%= horario.data_horario_formatado %>
              </span>
            </li>
            <% }) %>
        </ul>
      </div>
    </div>

    <!-- Seção Preço -->
    <div class="planos-section">
      <h2>Escolha o Preço da Consulta</h2>
      <div class="planos">
        <div class="plano">
          <span>Consulta Simples - R$100,00</span>
          <button onclick="selecionarPreco(100)">Selecionar</button>
        </div>
        <div class="plano">
          <span>Consulta Avançada - R$150,00</span>
          <button onclick="selecionarPreco(150)">Selecionar</button>
        </div>
        <div class="plano">
          <span>Pacote de 5 Consultas - R$400,00</span>
          <button onclick="selecionarPreco(400)">Selecionar</button>
        </div>
      </div>
      <div id="paypal-button-container"></div>
      <form id="agendarForm" action="/agendar-consulta" method="POST" onsubmit="return validarFormulario()">
        <input type="hidden" id="horarioSelecionado" name="dataHorarioSelecionado" required>
        <input type="hidden" id="precoConsulta" name="precoConsulta" required>
        <input type="hidden" id="profissionalId" name="profissionalId" value="<%= profissional.id %>">
        <button type="submit">Confirmar Agendamento</button>
      </form>
    </div>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script
      src="https://www.paypal.com/sdk/js?client-id=AaTZmQU_-ISJp53Kx5HwPSTt8epEmOyadfoJkkbCK0XmAcTTlufKLtKsZzXjNaAfN8NbpmLJjJme8WDa&currency=BRL"></script>
    <script>
      function selecionarHorario(element, horario) {
        document.querySelectorAll('.horario-btn').forEach(btn => btn.classList.remove('active'));
        element.classList.add('active');
        document.getElementById('horarioSelecionado').value = horario;
      }

      function selecionarPreco(preco) {
        document.getElementById('precoConsulta').value = preco;
        renderPaypalButton(preco);
      }

      function validarFormulario() {
        const horario = document.getElementById('horarioSelecionado').value;
        const valor = document.getElementById('precoConsulta').value;
        if (!horario || !valor) {
          alert("Por favor, selecione o horário e o preço da consulta.");
          return false;
        }
        return true;
      }

      function renderPaypalButton(amount) {
        document.getElementById("paypal-button-container").innerHTML = "";
        paypal.Buttons({
          style: {
            layout: "vertical",
            color: "blue",
            shape: "rect",
            label: "paypal",
          },
          createOrder: function (data, actions) {
            return actions.order.create({
              purchase_units: [{
                amount: {
                  value: amount.toFixed(2),
                },
              }],
            });
          },
          onApprove: function (data, actions) {
            return actions.order.capture().then(function (details) {
              alert("Transação concluída por " + details.payer.name.given_name + "!");
            });
          },
          onError: function (err) {
            console.error("Erro no pagamento:", err);
          },
        }).render("#paypal-button-container");
      }
    </script>
  </body>

</html>